<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product CRUD Tester</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f9; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        h2 { border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-top: 20px; color: #333; }
        .op-section { margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background-color: #f9f9f9; }
        input[type="text"], input[type="number"], textarea { width: calc(100% - 22px); padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; }
        button { padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background-color: #0056b3; }
        #results { margin-top: 20px; padding: 15px; background-color: #e9ecef; border-radius: 4px; white-space: pre-wrap; word-wrap: break-word; font-family: monospace; }
        .product-list { margin-top: 15px; list-style: none; padding: 0; }
        .product-list li { padding: 8px 0; border-bottom: 1px dotted #ccc; display: flex; justify-content: space-between; align-items: center; }
        .product-list li:last-child { border-bottom: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Product API Tester (Express/MySQL)</h1>
        <p>Ensure your Node.js server is running on <code>http://localhost:3000</code>.</p>

        <div class="op-section">
            <h2>1. Read All Products (GET /products)</h2>
            <button onclick="fetchAllProducts()">Fetch All Products</button>
            <ul id="product-list" class="product-list">
                </ul>
        </div>

        <div class="op-section">
            <h2>2. Create New Product (POST /products)</h2>
            <input type="text" id="post-name" placeholder="Name (required)">
            <input type="number" id="post-price" placeholder="Price (required)" step="0.01">
            <textarea id="post-description" placeholder="Description (optional)"></textarea>
            <button onclick="createProduct()">Create Product</button>
        </div>

        <div class="op-section">
            <h2>3. Read, Update, or Delete by ID</h2>
            <input type="number" id="id-input" placeholder="Enter Product ID" min="1">
            <button onclick="fetchProductById()">GET</button>
            <button onclick="deleteProductById()" style="background-color: #dc3545;">DELETE</button>
            
            <h3 style="margin-top: 15px;">Update (PUT /products/:id)</h3>
            <input type="text" id="put-name" placeholder="New Name (optional)">
            <input type="number" id="put-price" placeholder="New Price (optional)" step="0.01">
            <textarea id="put-description" placeholder="New Description (optional)"></textarea>
            <button onclick="updateProduct()">Update Product</button>
        </div>

        <h2>API Response</h2>
        <pre id="results">Awaiting API calls...</pre>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/products';
        const resultsEl = document.getElementById('results');
        const listEl = document.getElementById('product-list');

        function displayResponse(data, status, method, url) {
            resultsEl.textContent = `
[${method} ${url}] Status: ${status}

${JSON.stringify(data, null, 2)}
            `.trim();
        }

        function displayError(err, url) {
            resultsEl.textContent = `
[ERROR] Failed to fetch ${url}
Details: ${err.message || 'Check if the server is running on port 3000.'}
            `.trim();
        }

        // --- 1. READ ALL ---
        async function fetchAllProducts() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                
                displayResponse(data, response.status, 'GET', '/products');
                renderProductList(data);
            } catch (err) {
                displayError(err, '/products');
            }
        }

        function renderProductList(products) {
            listEl.innerHTML = products.map(p => `
                <li>
                    <strong>ID ${p.id}:</strong> ${p.name} - $${p.price}
                    <button onclick="document.getElementById('id-input').value = ${p.id}; fetchProductById()">View Details</button>
                </li>
            `).join('');
            if (products.length === 0) {
                listEl.innerHTML = '<li>No products found. Create one above!</li>';
            }
        }


        // --- 2. CREATE ---
        async function createProduct() {
            const name = document.getElementById('post-name').value;
            const price = parseFloat(document.getElementById('post-price').value);
            const description = document.getElementById('post-description').value;
            
            if (!name || isNaN(price)) {
                alert("Name and Price are required.");
                return;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, price, description })
                });
                const data = await response.json();
                
                displayResponse(data, response.status, 'POST', '/products');
                // Clear inputs and refresh list
                document.getElementById('post-name').value = '';
                document.getElementById('post-price').value = '';
                document.getElementById('post-description').value = '';
                fetchAllProducts();

            } catch (err) {
                displayError(err, '/products');
            }
        }


        // --- 3. READ ONE ---
        async function fetchProductById() {
            const id = document.getElementById('id-input').value;
            if (!id) return alert("Enter a Product ID.");

            try {
                const response = await fetch(`${API_URL}/${id}`);
                const data = await response.json();
                
                displayResponse(data, response.status, 'GET', `/products/${id}`);
            } catch (err) {
                displayError(err, `/products/${id}`);
            }
        }


        // --- 4. UPDATE ---
        async function updateProduct() {
            const id = document.getElementById('id-input').value;
            const name = document.getElementById('put-name').value;
            const price = parseFloat(document.getElementById('put-price').value);
            const description = document.getElementById('put-description').value;

            if (!id) return alert("Enter a Product ID to update.");

            const updateBody = {};
            if (name) updateBody.name = name;
            if (!isNaN(price)) updateBody.price = price;
            if (description) updateBody.description = description;

            if (Object.keys(updateBody).length === 0) {
                return alert("Provide at least one field to update.");
            }

            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updateBody)
                });
                
                // Note: PUT response is usually status 200 with no body on success
                const data = response.status === 200 ? { message: 'Product updated successfully' } : await response.json();
                
                displayResponse(data, response.status, 'PUT', `/products/${id}`);
                // Clear update inputs
                document.getElementById('put-name').value = '';
                document.getElementById('put-price').value = '';
                document.getElementById('put-description').value = '';
                fetchAllProducts(); // Refresh list to see change

            } catch (err) {
                displayError(err, `/products/${id}`);
            }
        }


        // --- 5. DELETE ---
        async function deleteProductById() {
            const id = document.getElementById('id-input').value;
            if (!id) return alert("Enter a Product ID to delete.");

            if (!confirm(`Are you sure you want to delete Product ID ${id}?`)) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/${id}`, {
                    method: 'DELETE'
                });
                
                const data = response.status === 204 ? { message: `Product ID ${id} deleted successfully (204 No Content)` } : await response.json();

                displayResponse(data, response.status, 'DELETE', `/products/${id}`);
                document.getElementById('id-input').value = '';
                fetchAllProducts(); // Refresh list
            } catch (err) {
                displayError(err, `/products/${id}`);
            }
        }

        // Initial load
        window.onload = fetchAllProducts;
    </script>
</body>
</html>